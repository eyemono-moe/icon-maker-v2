import type { APIEvent } from "@solidjs/start/server";
import { renderToString } from "solid-js/web";
import { optimize } from "svgo";
import { type Input, literal, object, optional, string, union } from "valibot";
import Icon from "~/components/Icon";
import {
  type IconParams,
  IconParamsProvider,
  parseParams,
} from "~/context/icon";
import { SsrPortalProvider } from "~/context/ssrPortal";
import { convertFromSvg } from "~/lib/image";
import { useQuery } from "~/lib/query";

const imageQuerySchema = object({
  p: optional(string()),
  f: optional(union([literal("png"), literal("svg")]), "svg"),
});
export type ImageQuery = Input<typeof imageQuerySchema>;

export async function GET(event: APIEvent) {
  const query = useQuery(event.nativeEvent, imageQuerySchema);
  let params: IconParams | undefined;
  if (query.p) {
    params = parseParams(query.p);
  }

  const svgText = renderToString(() => (
    // biome-ignore lint/a11y/noSvgWithoutTitle: <explanation>
    <svg
      width="1000"
      height="525"
      viewBox="0 0 1000 525"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <rect width="1000" height="525" fill="white" />
      <mask id="mask">
        <rect x="81" y="62.5" width="400" height="400" rx="200" fill="white" />
      </mask>
      <g mask="url(#mask)">
        <g transform="translate(81,62.5)">
          <SsrPortalProvider>
            <IconParamsProvider params={params}>
              <Icon />
            </IconParamsProvider>
          </SsrPortalProvider>
        </g>
      </g>
      <path
        d="M516.392 221.416C519.635 221.416 522.408 222.035 524.712 223.272C527.059 224.509 528.872 226.301 530.152 228.648C531.432 230.995 532.072 233.875 532.072 237.288V241.896H509.544C509.629 244.584 510.419 246.696 511.912 248.232C513.448 249.768 515.56 250.536 518.248 250.536C520.509 250.536 522.557 250.323 524.392 249.896C526.227 249.427 528.125 248.723 530.088 247.784V255.144C528.381 255.997 526.568 256.616 524.648 257C522.771 257.427 520.488 257.64 517.8 257.64C514.301 257.64 511.208 257 508.52 255.72C505.832 254.397 503.72 252.413 502.184 249.768C500.648 247.123 499.88 243.795 499.88 239.784C499.88 235.688 500.563 232.296 501.928 229.608C503.336 226.877 505.277 224.829 507.752 223.464C510.227 222.099 513.107 221.416 516.392 221.416ZM516.456 228.2C514.621 228.2 513.085 228.797 511.848 229.992C510.653 231.187 509.949 233.043 509.736 235.56H523.112C523.112 234.152 522.856 232.893 522.344 231.784C521.875 230.675 521.149 229.8 520.168 229.16C519.187 228.52 517.949 228.2 516.456 228.2ZM533.562 222.056H543.995L550.587 241.704C550.8 242.344 550.971 242.984 551.099 243.624C551.269 244.264 551.397 244.925 551.483 245.608C551.611 246.291 551.696 247.016 551.739 247.784H551.931C552.059 246.675 552.229 245.629 552.443 244.648C552.699 243.624 552.976 242.643 553.275 241.704L559.739 222.056H569.979L555.195 261.48C554.299 263.869 553.125 265.875 551.675 267.496C550.267 269.117 548.624 270.333 546.747 271.144C544.869 271.955 542.821 272.36 540.603 272.36C539.536 272.36 538.597 272.296 537.786 272.168C537.019 272.083 536.336 271.976 535.739 271.848V264.296C536.208 264.381 536.763 264.467 537.403 264.552C538.085 264.637 538.789 264.68 539.515 264.68C540.837 264.68 541.968 264.403 542.907 263.848C543.888 263.293 544.699 262.525 545.339 261.544C545.979 260.605 546.491 259.581 546.875 258.472L547.451 256.744L533.562 222.056ZM589.392 221.416C592.635 221.416 595.408 222.035 597.712 223.272C600.059 224.509 601.872 226.301 603.152 228.648C604.432 230.995 605.072 233.875 605.072 237.288V241.896H582.544C582.629 244.584 583.419 246.696 584.912 248.232C586.448 249.768 588.56 250.536 591.248 250.536C593.509 250.536 595.557 250.323 597.392 249.896C599.227 249.427 601.125 248.723 603.088 247.784V255.144C601.381 255.997 599.568 256.616 597.648 257C595.771 257.427 593.488 257.64 590.8 257.64C587.301 257.64 584.208 257 581.52 255.72C578.832 254.397 576.72 252.413 575.184 249.768C573.648 247.123 572.88 243.795 572.88 239.784C572.88 235.688 573.563 232.296 574.928 229.608C576.336 226.877 578.277 224.829 580.752 223.464C583.227 222.099 586.107 221.416 589.392 221.416ZM589.456 228.2C587.621 228.2 586.085 228.797 584.848 229.992C583.653 231.187 582.949 233.043 582.736 235.56H596.112C596.112 234.152 595.856 232.893 595.344 231.784C594.875 230.675 594.149 229.8 593.168 229.16C592.187 228.52 590.949 228.2 589.456 228.2ZM653.829 221.416C657.797 221.416 660.783 222.44 662.789 224.488C664.837 226.493 665.861 229.736 665.861 234.216V257H656.325V236.584C656.325 234.067 655.898 232.189 655.045 230.952C654.191 229.672 652.869 229.032 651.077 229.032C648.559 229.032 646.767 229.928 645.701 231.72C644.634 233.512 644.101 236.093 644.101 239.464V257H634.565V236.584C634.565 234.92 634.373 233.533 633.989 232.424C633.605 231.315 633.029 230.483 632.261 229.928C631.493 229.331 630.511 229.032 629.317 229.032C627.567 229.032 626.181 229.48 625.157 230.376C624.133 231.272 623.407 232.573 622.981 234.28C622.554 235.987 622.341 238.077 622.341 240.552V257H612.805V222.056H620.101L621.381 226.536H621.893C622.618 225.341 623.514 224.381 624.581 223.656C625.647 222.888 626.821 222.333 628.101 221.992C629.423 221.608 630.746 221.416 632.069 221.416C634.629 221.416 636.805 221.843 638.597 222.696C640.389 223.507 641.754 224.787 642.693 226.536H643.525C644.591 224.744 646.063 223.443 647.941 222.632C649.861 221.821 651.823 221.416 653.829 221.416ZM707.424 239.464C707.424 242.365 707.018 244.947 706.208 247.208C705.44 249.469 704.309 251.389 702.816 252.968C701.365 254.504 699.594 255.677 697.504 256.488C695.413 257.256 693.045 257.64 690.4 257.64C687.968 257.64 685.706 257.256 683.616 256.488C681.568 255.677 679.797 254.504 678.304 252.968C676.81 251.389 675.637 249.469 674.784 247.208C673.973 244.947 673.568 242.365 673.568 239.464C673.568 235.581 674.25 232.317 675.616 229.672C676.981 226.984 678.944 224.936 681.504 223.528C684.064 222.12 687.093 221.416 690.592 221.416C693.877 221.416 696.778 222.12 699.296 223.528C701.813 224.936 703.797 226.984 705.248 229.672C706.698 232.317 707.424 235.581 707.424 239.464ZM683.296 239.464C683.296 241.768 683.53 243.709 684 245.288C684.512 246.824 685.301 247.997 686.368 248.808C687.434 249.576 688.821 249.96 690.528 249.96C692.234 249.96 693.6 249.576 694.624 248.808C695.69 247.997 696.458 246.824 696.928 245.288C697.44 243.709 697.696 241.768 697.696 239.464C697.696 237.16 697.44 235.24 696.928 233.704C696.458 232.168 695.69 231.016 694.624 230.248C693.557 229.48 692.17 229.096 690.464 229.096C687.946 229.096 686.112 229.971 684.96 231.72C683.85 233.427 683.296 236.008 683.296 239.464ZM735.145 221.416C738.899 221.416 741.907 222.44 744.169 224.488C746.43 226.493 747.561 229.736 747.561 234.216V257H738.025V236.584C738.025 234.067 737.577 232.189 736.681 230.952C735.785 229.672 734.355 229.032 732.393 229.032C729.491 229.032 727.507 230.035 726.441 232.04C725.374 234.003 724.841 236.84 724.841 240.552V257H715.305V222.056H722.601L723.881 226.536H724.393C725.161 225.341 726.099 224.381 727.208 223.656C728.318 222.888 729.555 222.333 730.921 221.992C732.286 221.608 733.694 221.416 735.145 221.416ZM789.111 239.464C789.111 242.365 788.706 244.947 787.895 247.208C787.127 249.469 785.996 251.389 784.503 252.968C783.052 254.504 781.282 255.677 779.191 256.488C777.1 257.256 774.732 257.64 772.087 257.64C769.655 257.64 767.394 257.256 765.303 256.488C763.255 255.677 761.484 254.504 759.991 252.968C758.498 251.389 757.324 249.469 756.471 247.208C755.66 244.947 755.255 242.365 755.255 239.464C755.255 235.581 755.938 232.317 757.303 229.672C758.668 226.984 760.631 224.936 763.191 223.528C765.751 222.12 768.78 221.416 772.279 221.416C775.564 221.416 778.466 222.12 780.983 223.528C783.5 224.936 785.484 226.984 786.935 229.672C788.386 232.317 789.111 235.581 789.111 239.464ZM764.983 239.464C764.983 241.768 765.218 243.709 765.687 245.288C766.199 246.824 766.988 247.997 768.055 248.808C769.122 249.576 770.508 249.96 772.215 249.96C773.922 249.96 775.287 249.576 776.311 248.808C777.378 247.997 778.146 246.824 778.615 245.288C779.127 243.709 779.383 241.768 779.383 239.464C779.383 237.16 779.127 235.24 778.615 233.704C778.146 232.168 777.378 231.016 776.311 230.248C775.244 229.48 773.858 229.096 772.151 229.096C769.634 229.096 767.799 229.971 766.647 231.72C765.538 233.427 764.983 236.008 764.983 239.464ZM795.648 252.52C795.648 250.557 796.181 249.192 797.248 248.424C798.315 247.613 799.616 247.208 801.152 247.208C802.645 247.208 803.925 247.613 804.992 248.424C806.059 249.192 806.592 250.557 806.592 252.52C806.592 254.397 806.059 255.763 804.992 256.616C803.925 257.427 802.645 257.832 801.152 257.832C799.616 257.832 798.315 257.427 797.248 256.616C796.181 255.763 795.648 254.397 795.648 252.52ZM839.626 246.632C839.626 248.979 839.071 250.984 837.962 252.648C836.853 254.269 835.189 255.507 832.97 256.36C830.751 257.213 827.999 257.64 824.714 257.64C822.282 257.64 820.191 257.469 818.442 257.128C816.693 256.829 814.943 256.317 813.194 255.592V247.72C815.071 248.573 817.098 249.277 819.274 249.832C821.45 250.387 823.37 250.664 825.034 250.664C826.911 250.664 828.234 250.387 829.002 249.832C829.813 249.277 830.218 248.552 830.218 247.656C830.218 247.059 830.047 246.525 829.706 246.056C829.407 245.587 828.725 245.053 827.658 244.456C826.591 243.859 824.927 243.091 822.666 242.152C820.49 241.213 818.698 240.296 817.29 239.4C815.882 238.461 814.837 237.352 814.154 236.072C813.471 234.749 813.13 233.107 813.13 231.144C813.13 227.901 814.389 225.469 816.906 223.848C819.423 222.227 822.773 221.416 826.954 221.416C829.13 221.416 831.199 221.629 833.162 222.056C835.125 222.483 837.151 223.187 839.242 224.168L836.362 231.016C835.21 230.504 834.101 230.056 833.034 229.672C831.967 229.288 830.922 228.989 829.898 228.776C828.917 228.563 827.893 228.456 826.826 228.456C825.418 228.456 824.351 228.648 823.626 229.032C822.943 229.416 822.602 229.992 822.602 230.76C822.602 231.315 822.773 231.827 823.114 232.296C823.498 232.723 824.202 233.192 825.226 233.704C826.293 234.216 827.85 234.899 829.898 235.752C831.903 236.563 833.631 237.416 835.082 238.312C836.533 239.165 837.642 240.253 838.41 241.576C839.221 242.856 839.626 244.541 839.626 246.632ZM855.375 257L842.062 222.056H852.047L858.767 241.96C859.023 242.728 859.236 243.539 859.407 244.392C859.62 245.245 859.769 246.077 859.855 246.888C859.983 247.699 860.068 248.445 860.111 249.128H860.367C860.409 248.403 860.495 247.635 860.623 246.824C860.751 246.013 860.9 245.203 861.071 244.392C861.284 243.539 861.519 242.728 861.775 241.96L868.495 222.056H878.479L865.167 257H855.375ZM894.82 221.416C896.953 221.416 898.873 221.843 900.58 222.696C902.287 223.549 903.737 224.829 904.932 226.536H905.188L905.956 222.056H914.02V257.064C914.02 260.392 913.359 263.187 912.036 265.448C910.756 267.709 908.815 269.416 906.212 270.568C903.609 271.763 900.388 272.36 896.548 272.36C894.073 272.36 891.769 272.211 889.636 271.912C887.545 271.613 885.497 271.08 883.492 270.312V262.696C884.943 263.293 886.393 263.784 887.844 264.168C889.337 264.595 890.852 264.893 892.388 265.064C893.967 265.277 895.545 265.384 897.124 265.384C899.599 265.384 901.433 264.723 902.628 263.4C903.865 262.077 904.484 260.093 904.484 257.448V256.744C904.484 256.019 904.505 255.272 904.548 254.504C904.633 253.736 904.697 253.053 904.74 252.456H904.484C903.289 254.291 901.86 255.613 900.196 256.424C898.532 257.235 896.655 257.64 894.564 257.64C890.425 257.64 887.183 256.061 884.836 252.904C882.532 249.704 881.38 245.267 881.38 239.592C881.38 235.752 881.913 232.488 882.98 229.8C884.047 227.069 885.583 225 887.588 223.592C889.636 222.141 892.047 221.416 894.82 221.416ZM897.828 229.16C896.335 229.16 895.076 229.565 894.052 230.376C893.071 231.144 892.324 232.317 891.812 233.896C891.343 235.432 891.108 237.373 891.108 239.72C891.108 243.219 891.663 245.843 892.772 247.592C893.881 249.299 895.609 250.152 897.956 250.152C899.193 250.152 900.26 250.003 901.156 249.704C902.052 249.363 902.777 248.829 903.332 248.104C903.929 247.336 904.377 246.355 904.676 245.16C904.975 243.965 905.124 242.515 905.124 240.808V239.656C905.124 237.139 904.868 235.112 904.356 233.576C903.844 232.04 903.055 230.931 901.988 230.248C900.921 229.523 899.535 229.16 897.828 229.16Z"
        fill="#313131"
      />
      <path
        d="M506.344 308.528C507.816 308.528 509.075 308.848 510.12 309.488C511.187 310.128 511.997 311.035 512.552 312.208C513.128 313.36 513.416 314.715 513.416 316.272V317.968H501.672C501.715 319.909 502.205 321.392 503.144 322.416C504.104 323.419 505.437 323.92 507.144 323.92C508.232 323.92 509.192 323.824 510.024 323.632C510.877 323.419 511.752 323.12 512.648 322.736V325.2C511.773 325.584 510.909 325.861 510.056 326.032C509.203 326.224 508.189 326.32 507.016 326.32C505.395 326.32 503.955 325.989 502.696 325.328C501.459 324.667 500.488 323.685 499.784 322.384C499.101 321.061 498.76 319.451 498.76 317.552C498.76 315.675 499.069 314.064 499.688 312.72C500.328 311.376 501.213 310.341 502.344 309.616C503.496 308.891 504.829 308.528 506.344 308.528ZM506.312 310.832C504.968 310.832 503.901 311.269 503.112 312.144C502.344 312.997 501.885 314.192 501.736 315.728H510.472C510.472 314.747 510.323 313.893 510.024 313.168C509.725 312.443 509.267 311.877 508.648 311.472C508.051 311.045 507.272 310.832 506.312 310.832ZM514.47 308.848H517.478L521.19 318.608C521.403 319.184 521.595 319.739 521.766 320.272C521.958 320.805 522.128 321.328 522.278 321.84C522.427 322.331 522.544 322.811 522.63 323.28H522.758C522.886 322.747 523.088 322.053 523.366 321.2C523.643 320.325 523.931 319.451 524.23 318.576L527.718 308.848H530.758L523.366 328.368C522.96 329.435 522.48 330.363 521.926 331.152C521.392 331.963 520.731 332.581 519.942 333.008C519.174 333.456 518.235 333.68 517.126 333.68C516.614 333.68 516.166 333.648 515.782 333.584C515.398 333.541 515.067 333.488 514.79 333.424V331.184C515.024 331.227 515.302 331.269 515.622 331.312C515.963 331.355 516.315 331.376 516.678 331.376C517.339 331.376 517.904 331.248 518.374 330.992C518.864 330.757 519.28 330.405 519.622 329.936C519.963 329.488 520.251 328.955 520.486 328.336L521.382 326.064L514.47 308.848ZM540.094 308.528C541.566 308.528 542.825 308.848 543.87 309.488C544.937 310.128 545.747 311.035 546.302 312.208C546.878 313.36 547.166 314.715 547.166 316.272V317.968H535.422C535.465 319.909 535.955 321.392 536.894 322.416C537.854 323.419 539.187 323.92 540.894 323.92C541.982 323.92 542.942 323.824 543.774 323.632C544.627 323.419 545.502 323.12 546.398 322.736V325.2C545.523 325.584 544.659 325.861 543.806 326.032C542.953 326.224 541.939 326.32 540.766 326.32C539.145 326.32 537.705 325.989 536.446 325.328C535.209 324.667 534.238 323.685 533.534 322.384C532.851 321.061 532.51 319.451 532.51 317.552C532.51 315.675 532.819 314.064 533.438 312.72C534.078 311.376 534.963 310.341 536.094 309.616C537.246 308.891 538.579 308.528 540.094 308.528ZM540.062 310.832C538.718 310.832 537.651 311.269 536.862 312.144C536.094 312.997 535.635 314.192 535.486 315.728H544.222C544.222 314.747 544.073 313.893 543.774 313.168C543.475 312.443 543.017 311.877 542.398 311.472C541.801 311.045 541.022 310.832 540.062 310.832ZM570.349 308.528C572.29 308.528 573.741 309.029 574.701 310.032C575.661 311.013 576.141 312.613 576.141 314.832V326H573.357V314.96C573.357 313.616 573.069 312.603 572.493 311.92C571.938 311.237 571.063 310.896 569.869 310.896C568.205 310.896 567.01 311.376 566.285 312.336C565.581 313.296 565.229 314.693 565.229 316.528V326H562.445V314.96C562.445 314.064 562.317 313.317 562.061 312.72C561.805 312.101 561.421 311.643 560.909 311.344C560.397 311.045 559.735 310.896 558.925 310.896C557.773 310.896 556.866 311.141 556.205 311.632C555.543 312.101 555.063 312.795 554.765 313.712C554.487 314.629 554.349 315.76 554.349 317.104V326H551.533V308.848H553.805L554.221 311.184H554.381C554.743 310.587 555.181 310.096 555.693 309.712C556.226 309.307 556.813 309.008 557.453 308.816C558.093 308.624 558.754 308.528 559.437 308.528C560.759 308.528 561.858 308.763 562.733 309.232C563.629 309.701 564.279 310.427 564.685 311.408H564.845C565.421 310.427 566.199 309.701 567.181 309.232C568.183 308.763 569.239 308.528 570.349 308.528ZM596.351 317.392C596.351 318.821 596.159 320.091 595.775 321.2C595.412 322.288 594.879 323.216 594.175 323.984C593.492 324.752 592.649 325.339 591.647 325.744C590.665 326.128 589.567 326.32 588.351 326.32C587.22 326.32 586.175 326.128 585.215 325.744C584.255 325.339 583.423 324.752 582.719 323.984C582.015 323.216 581.46 322.288 581.055 321.2C580.671 320.091 580.479 318.821 580.479 317.392C580.479 315.493 580.799 313.893 581.439 312.592C582.079 311.269 582.996 310.267 584.191 309.584C585.385 308.88 586.804 308.528 588.447 308.528C590.004 308.528 591.369 308.88 592.543 309.584C593.737 310.267 594.665 311.269 595.327 312.592C596.009 313.893 596.351 315.493 596.351 317.392ZM583.391 317.392C583.391 318.736 583.561 319.909 583.903 320.912C584.265 321.893 584.82 322.651 585.567 323.184C586.313 323.717 587.263 323.984 588.415 323.984C589.567 323.984 590.516 323.717 591.263 323.184C592.009 322.651 592.553 321.893 592.895 320.912C593.257 319.909 593.439 318.736 593.439 317.392C593.439 316.027 593.257 314.864 592.895 313.904C592.532 312.944 591.977 312.208 591.231 311.696C590.505 311.163 589.556 310.896 588.383 310.896C586.633 310.896 585.364 311.472 584.575 312.624C583.785 313.776 583.391 315.365 583.391 317.392ZM609.07 308.528C611.118 308.528 612.664 309.029 613.71 310.032C614.755 311.013 615.278 312.613 615.278 314.832V326H612.494V315.024C612.494 313.637 612.184 312.603 611.566 311.92C610.947 311.237 609.976 310.896 608.654 310.896C606.755 310.896 605.443 311.429 604.718 312.496C603.992 313.563 603.63 315.099 603.63 317.104V326H600.814V308.848H603.086L603.502 311.184H603.662C604.046 310.587 604.515 310.096 605.07 309.712C605.646 309.307 606.275 309.008 606.958 308.816C607.64 308.624 608.344 308.528 609.07 308.528ZM635.507 317.392C635.507 318.821 635.315 320.091 634.931 321.2C634.568 322.288 634.035 323.216 633.331 323.984C632.648 324.752 631.806 325.339 630.803 325.744C629.822 326.128 628.723 326.32 627.507 326.32C626.376 326.32 625.331 326.128 624.371 325.744C623.411 325.339 622.579 324.752 621.875 323.984C621.171 323.216 620.616 322.288 620.211 321.2C619.827 320.091 619.635 318.821 619.635 317.392C619.635 315.493 619.955 313.893 620.595 312.592C621.235 311.269 622.152 310.267 623.347 309.584C624.542 308.88 625.96 308.528 627.603 308.528C629.16 308.528 630.526 308.88 631.699 309.584C632.894 310.267 633.822 311.269 634.483 312.592C635.166 313.893 635.507 315.493 635.507 317.392ZM622.547 317.392C622.547 318.736 622.718 319.909 623.059 320.912C623.422 321.893 623.976 322.651 624.723 323.184C625.47 323.717 626.419 323.984 627.571 323.984C628.723 323.984 629.672 323.717 630.419 323.184C631.166 322.651 631.71 321.893 632.051 320.912C632.414 319.909 632.595 318.736 632.595 317.392C632.595 316.027 632.414 314.864 632.051 313.904C631.688 312.944 631.134 312.208 630.387 311.696C629.662 311.163 628.712 310.896 627.539 310.896C625.79 310.896 624.52 311.472 623.731 312.624C622.942 313.776 622.547 315.365 622.547 317.392ZM639.554 324.272C639.554 323.483 639.746 322.928 640.13 322.608C640.514 322.288 640.973 322.128 641.506 322.128C642.061 322.128 642.53 322.288 642.914 322.608C643.319 322.928 643.522 323.483 643.522 324.272C643.522 325.04 643.319 325.595 642.914 325.936C642.53 326.277 642.061 326.448 641.506 326.448C640.973 326.448 640.514 326.277 640.13 325.936C639.746 325.595 639.554 325.04 639.554 324.272ZM667.349 308.528C669.29 308.528 670.741 309.029 671.701 310.032C672.661 311.013 673.141 312.613 673.141 314.832V326H670.357V314.96C670.357 313.616 670.069 312.603 669.493 311.92C668.938 311.237 668.063 310.896 666.869 310.896C665.205 310.896 664.01 311.376 663.285 312.336C662.581 313.296 662.229 314.693 662.229 316.528V326H659.445V314.96C659.445 314.064 659.317 313.317 659.061 312.72C658.805 312.101 658.421 311.643 657.909 311.344C657.397 311.045 656.735 310.896 655.925 310.896C654.773 310.896 653.866 311.141 653.205 311.632C652.543 312.101 652.063 312.795 651.765 313.712C651.487 314.629 651.349 315.76 651.349 317.104V326H648.533V308.848H650.805L651.221 311.184H651.381C651.743 310.587 652.181 310.096 652.693 309.712C653.226 309.307 653.813 309.008 654.453 308.816C655.093 308.624 655.754 308.528 656.437 308.528C657.759 308.528 658.858 308.763 659.733 309.232C660.629 309.701 661.279 310.427 661.685 311.408H661.845C662.421 310.427 663.199 309.701 664.181 309.232C665.183 308.763 666.239 308.528 667.349 308.528ZM693.351 317.392C693.351 318.821 693.159 320.091 692.775 321.2C692.412 322.288 691.879 323.216 691.175 323.984C690.492 324.752 689.649 325.339 688.647 325.744C687.665 326.128 686.567 326.32 685.351 326.32C684.22 326.32 683.175 326.128 682.215 325.744C681.255 325.339 680.423 324.752 679.719 323.984C679.015 323.216 678.46 322.288 678.055 321.2C677.671 320.091 677.479 318.821 677.479 317.392C677.479 315.493 677.799 313.893 678.439 312.592C679.079 311.269 679.996 310.267 681.191 309.584C682.385 308.88 683.804 308.528 685.447 308.528C687.004 308.528 688.369 308.88 689.543 309.584C690.737 310.267 691.665 311.269 692.327 312.592C693.009 313.893 693.351 315.493 693.351 317.392ZM680.391 317.392C680.391 318.736 680.561 319.909 680.903 320.912C681.265 321.893 681.82 322.651 682.567 323.184C683.313 323.717 684.263 323.984 685.415 323.984C686.567 323.984 687.516 323.717 688.263 323.184C689.009 322.651 689.553 321.893 689.895 320.912C690.257 319.909 690.439 318.736 690.439 317.392C690.439 316.027 690.257 314.864 689.895 313.904C689.532 312.944 688.977 312.208 688.231 311.696C687.505 311.163 686.556 310.896 685.383 310.896C683.633 310.896 682.364 311.472 681.575 312.624C680.785 313.776 680.391 315.365 680.391 317.392ZM704.438 308.528C705.91 308.528 707.168 308.848 708.214 309.488C709.28 310.128 710.091 311.035 710.646 312.208C711.222 313.36 711.51 314.715 711.51 316.272V317.968H699.766C699.808 319.909 700.299 321.392 701.238 322.416C702.198 323.419 703.531 323.92 705.238 323.92C706.326 323.92 707.286 323.824 708.118 323.632C708.971 323.419 709.846 323.12 710.742 322.736V325.2C709.867 325.584 709.003 325.861 708.15 326.032C707.296 326.224 706.283 326.32 705.11 326.32C703.488 326.32 702.048 325.989 700.79 325.328C699.552 324.667 698.582 323.685 697.878 322.384C697.195 321.061 696.854 319.451 696.854 317.552C696.854 315.675 697.163 314.064 697.782 312.72C698.422 311.376 699.307 310.341 700.438 309.616C701.59 308.891 702.923 308.528 704.438 308.528ZM704.406 310.832C703.062 310.832 701.995 311.269 701.206 312.144C700.438 312.997 699.979 314.192 699.83 315.728H708.566C708.566 314.747 708.416 313.893 708.118 313.168C707.819 312.443 707.36 311.877 706.742 311.472C706.144 311.045 705.366 310.832 704.406 310.832ZM727.005 308.848V326H724.189V308.848H727.005ZM725.629 302.416C726.055 302.416 726.429 302.565 726.749 302.864C727.09 303.141 727.261 303.589 727.261 304.208C727.261 304.805 727.09 305.253 726.749 305.552C726.429 305.851 726.055 306 725.629 306C725.159 306 724.765 305.851 724.445 305.552C724.125 305.253 723.965 304.805 723.965 304.208C723.965 303.589 724.125 303.141 724.445 302.864C724.765 302.565 725.159 302.416 725.629 302.416ZM739.319 326.32C737.804 326.32 736.449 326.011 735.255 325.392C734.081 324.773 733.153 323.813 732.471 322.512C731.809 321.211 731.479 319.547 731.479 317.52C731.479 315.408 731.831 313.691 732.535 312.368C733.239 311.045 734.188 310.075 735.383 309.456C736.599 308.837 737.975 308.528 739.511 308.528C740.385 308.528 741.228 308.624 742.039 308.816C742.849 308.987 743.511 309.2 744.023 309.456L743.159 311.792C742.647 311.6 742.049 311.419 741.367 311.248C740.684 311.077 740.044 310.992 739.447 310.992C738.295 310.992 737.345 311.237 736.599 311.728C735.852 312.219 735.297 312.944 734.935 313.904C734.572 314.864 734.391 316.059 734.391 317.488C734.391 318.853 734.572 320.016 734.935 320.976C735.297 321.936 735.841 322.661 736.567 323.152C737.292 323.643 738.199 323.888 739.287 323.888C740.225 323.888 741.047 323.792 741.751 323.6C742.476 323.408 743.137 323.173 743.735 322.896V325.392C743.159 325.691 742.519 325.915 741.815 326.064C741.132 326.235 740.3 326.32 739.319 326.32ZM762.726 317.392C762.726 318.821 762.534 320.091 762.15 321.2C761.787 322.288 761.254 323.216 760.55 323.984C759.867 324.752 759.024 325.339 758.022 325.744C757.04 326.128 755.942 326.32 754.726 326.32C753.595 326.32 752.55 326.128 751.59 325.744C750.63 325.339 749.798 324.752 749.094 323.984C748.39 323.216 747.835 322.288 747.43 321.2C747.046 320.091 746.854 318.821 746.854 317.392C746.854 315.493 747.174 313.893 747.814 312.592C748.454 311.269 749.371 310.267 750.566 309.584C751.76 308.88 753.179 308.528 754.822 308.528C756.379 308.528 757.744 308.88 758.918 309.584C760.112 310.267 761.04 311.269 761.702 312.592C762.384 313.893 762.726 315.493 762.726 317.392ZM749.766 317.392C749.766 318.736 749.936 319.909 750.278 320.912C750.64 321.893 751.195 322.651 751.942 323.184C752.688 323.717 753.638 323.984 754.79 323.984C755.942 323.984 756.891 323.717 757.638 323.184C758.384 322.651 758.928 321.893 759.27 320.912C759.632 319.909 759.814 318.736 759.814 317.392C759.814 316.027 759.632 314.864 759.27 313.904C758.907 312.944 758.352 312.208 757.606 311.696C756.88 311.163 755.931 310.896 754.758 310.896C753.008 310.896 751.739 311.472 750.95 312.624C750.16 313.776 749.766 315.365 749.766 317.392ZM775.445 308.528C777.493 308.528 779.039 309.029 780.085 310.032C781.13 311.013 781.653 312.613 781.653 314.832V326H778.869V315.024C778.869 313.637 778.559 312.603 777.941 311.92C777.322 311.237 776.351 310.896 775.029 310.896C773.13 310.896 771.818 311.429 771.093 312.496C770.367 313.563 770.005 315.099 770.005 317.104V326H767.189V308.848H769.461L769.877 311.184H770.037C770.421 310.587 770.89 310.096 771.445 309.712C772.021 309.307 772.65 309.008 773.333 308.816C774.015 308.624 774.719 308.528 775.445 308.528ZM814.099 308.528C816.04 308.528 817.491 309.029 818.451 310.032C819.411 311.013 819.891 312.613 819.891 314.832V326H817.107V314.96C817.107 313.616 816.819 312.603 816.243 311.92C815.688 311.237 814.813 310.896 813.619 310.896C811.955 310.896 810.76 311.376 810.035 312.336C809.331 313.296 808.979 314.693 808.979 316.528V326H806.195V314.96C806.195 314.064 806.067 313.317 805.811 312.72C805.555 312.101 805.171 311.643 804.659 311.344C804.147 311.045 803.485 310.896 802.675 310.896C801.523 310.896 800.616 311.141 799.955 311.632C799.293 312.101 798.813 312.795 798.515 313.712C798.237 314.629 798.099 315.76 798.099 317.104V326H795.283V308.848H797.555L797.971 311.184H798.131C798.493 310.587 798.931 310.096 799.443 309.712C799.976 309.307 800.563 309.008 801.203 308.816C801.843 308.624 802.504 308.528 803.187 308.528C804.509 308.528 805.608 308.763 806.483 309.232C807.379 309.701 808.029 310.427 808.435 311.408H808.595C809.171 310.427 809.949 309.701 810.931 309.232C811.933 308.763 812.989 308.528 814.099 308.528ZM831.685 308.56C833.775 308.56 835.322 309.019 836.325 309.936C837.327 310.853 837.829 312.315 837.829 314.32V326H835.781L835.237 323.568H835.109C834.618 324.187 834.106 324.709 833.573 325.136C833.061 325.541 832.463 325.84 831.781 326.032C831.119 326.224 830.309 326.32 829.349 326.32C828.325 326.32 827.397 326.139 826.565 325.776C825.754 325.413 825.114 324.859 824.645 324.112C824.175 323.344 823.941 322.384 823.941 321.232C823.941 319.525 824.613 318.213 825.957 317.296C827.301 316.357 829.37 315.845 832.165 315.76L835.077 315.664V314.64C835.077 313.211 834.767 312.219 834.149 311.664C833.53 311.109 832.655 310.832 831.525 310.832C830.629 310.832 829.775 310.971 828.965 311.248C828.154 311.504 827.397 311.803 826.693 312.144L825.829 310.032C826.575 309.627 827.461 309.285 828.485 309.008C829.509 308.709 830.575 308.56 831.685 308.56ZM832.517 317.712C830.383 317.797 828.901 318.139 828.069 318.736C827.258 319.333 826.853 320.176 826.853 321.264C826.853 322.224 827.141 322.928 827.717 323.376C828.314 323.824 829.071 324.048 829.989 324.048C831.439 324.048 832.645 323.653 833.605 322.864C834.565 322.053 835.045 320.816 835.045 319.152V317.616L832.517 317.712ZM845.91 314.384C845.91 314.725 845.889 315.173 845.846 315.728C845.825 316.283 845.804 316.763 845.782 317.168H845.91C846.038 316.997 846.23 316.752 846.486 316.432C846.742 316.112 846.998 315.792 847.254 315.472C847.532 315.131 847.766 314.853 847.958 314.64L853.43 308.848H856.726L849.782 316.176L857.206 326H853.814L847.862 318L845.91 319.696V326H843.126V301.68H845.91V314.384ZM866.844 308.528C868.316 308.528 869.575 308.848 870.62 309.488C871.687 310.128 872.497 311.035 873.052 312.208C873.628 313.36 873.916 314.715 873.916 316.272V317.968H862.172C862.215 319.909 862.705 321.392 863.644 322.416C864.604 323.419 865.937 323.92 867.644 323.92C868.732 323.92 869.692 323.824 870.524 323.632C871.377 323.419 872.252 323.12 873.148 322.736V325.2C872.273 325.584 871.409 325.861 870.556 326.032C869.703 326.224 868.689 326.32 867.516 326.32C865.895 326.32 864.455 325.989 863.196 325.328C861.959 324.667 860.988 323.685 860.284 322.384C859.601 321.061 859.26 319.451 859.26 317.552C859.26 315.675 859.569 314.064 860.188 312.72C860.828 311.376 861.713 310.341 862.844 309.616C863.996 308.891 865.329 308.528 866.844 308.528ZM866.812 310.832C865.468 310.832 864.401 311.269 863.612 312.144C862.844 312.997 862.385 314.192 862.236 315.728H870.972C870.972 314.747 870.823 313.893 870.524 313.168C870.225 312.443 869.767 311.877 869.148 311.472C868.551 311.045 867.772 310.832 866.812 310.832ZM886.283 308.528C886.603 308.528 886.944 308.549 887.307 308.592C887.691 308.613 888.021 308.656 888.299 308.72L887.947 311.312C887.669 311.248 887.36 311.195 887.019 311.152C886.699 311.109 886.389 311.088 886.091 311.088C885.429 311.088 884.8 311.227 884.203 311.504C883.605 311.781 883.072 312.176 882.603 312.688C882.133 313.179 881.76 313.776 881.483 314.48C881.227 315.184 881.099 315.973 881.099 316.848V326H878.283V308.848H880.587L880.907 311.984H881.035C881.397 311.344 881.835 310.768 882.347 310.256C882.859 309.723 883.445 309.307 884.107 309.008C884.768 308.688 885.493 308.528 886.283 308.528Z"
        fill="#313131"
      />
    </svg>
  ));

  const optimized = optimize(svgText, {
    plugins: [
      "removeComments",
      "removeUselessDefs",
      {
        name: "removeUnknownsAndDefaults",
        params: {
          keepDataAttrs: false,
        },
      },
    ],
  });

  const png = await convertFromSvg(optimized.data, "png");
  return new Response(png, {
    headers: {
      "Content-Type": "image/png",
    },
  });
}
